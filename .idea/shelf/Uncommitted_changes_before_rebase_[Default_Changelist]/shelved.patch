Index: jg/templates/jg/cbtpm.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\r\n{% load static %}\r\n<html lang=\"ja\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <title>CBT_PM</title>\r\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css\" integrity=\"sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO\" crossorigin=\"anonymous\">\r\n    <script src=\"https://code.jquery.com/jquery-3.3.1.min.js\" integrity=\"sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=\" crossorigin=\"anonymous\"></script>\r\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\" integrity=\"sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49\" crossorigin=\"anonymous\"></script>\r\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js\" integrity=\"sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy\" crossorigin=\"anonymous\"></script>\r\n\r\n<script>\r\n$(function($){\r\n    $(window).on('beforeunload',function(e){\r\n        //e.preventDefault();\r\n        //e.returnValue = '';\r\n        console.log('beforeunload');\r\n        return '更新しますか？';\r\n    });\r\n    var res_list = [\"\",\"ア\",\"イ\",\"ウ\",\"エ\",\"オ\",\"カ\",\"キ\",\"ク\",\"ケ\",\"コ\",\"サ\",\"シ\",\"ス\",\"セ\"];\r\n    var a_dict = {\r\n        'r_id':'{{ r_id }}','q_test':'{{ dict.q_test }}','q_period':'{{ dict.q_period }}',\r\n        'list':[{% for q in dict.list %}{'q_q':'{{ q.q_num }}','list':[\r\n        {% for q2 in q.list %}\r\n        {'q_question':'{{ q2.q_question }}','q_symbol':'{{ q2.q_symbol }}','u_answer':''},\r\n        {% endfor %}\r\n        ]},{% endfor %}]\r\n    };\r\n    var dict = {\r\n            'q_test' : '{{ dict.q_test }}','q_period' : '{{ dict.q_period }}',\r\n            'list' : [\r\n                {% for q in dict.list %}\r\n                {'q_q':'{{ q.q_num }}','pdf':'{{ q.pdf }}','list':[\r\n                {% for q2 in q.list %}\r\n                { 'q_question':'{{ q2.q_question }}','q_symbol':'{{ q2.q_symbol }}','q_lastanswer':'{{ q2.q_lastanswer }}','u_answer':''},\r\n                {% endfor %}\r\n                ]},\r\n                {% endfor %}\r\n            ]\r\n    };\r\n\r\n    var page = 1;\r\n    var pdf = '';\r\n\r\n    //JSONオブジェクトを文字列に変える\r\n    function getJsonStr(json){\r\n        return JSON.stringify(json);\r\n    }\r\n\r\n    //CSRF Tokenを取得する\r\n    function getCSRFToken(){\r\n        var csrftoken = jQuery(\"[name=csrfmiddlewaretoken]\").val();\r\n        return csrftoken;\r\n    }\r\n    //解答を変更\r\n    $(document).on(\"change\", \"select.answer\", function(){\r\n        var u_answer = $(this).val();\r\n        var q_question = $(this).attr('id').split('_')[0];\r\n        var q_symbol = $(this).attr('id').split('_')[1];\r\n        var q_q = $('#q_q').text();\r\n\r\n        for( var i = 0 ; i < a_dict['list'].length ; i++ ){\r\n            if(a_dict['list'][i]['q_q'] == q_q ){\r\n                var item = a_dict['list'][i];\r\n\r\n                for( var j = 0 ; j < item['list'].length ; j++ ){\r\n                    if( item['list'][j]['q_question'] == q_question && item['list'][j]['q_symbol'] == q_symbol ){\r\n                        item['list'][j]['u_answer'] = u_answer;\r\n                        console.log(a_dict['list'][i]['q_q']);\r\n                        console.log(item['list'][j]['q_question']);\r\n                        console.log(item['list'][j]['q_symbol']);\r\n                        console.log(item['list'][j]['u_answer']);\r\n\r\n                    }\r\n                }\r\n\r\n            }\r\n        }\r\n    });\r\n\r\n    //終了ボタン\r\n    $('#endbtn').on('click',function(){\r\n        $('#a_dict').val( getJsonStr( a_dict ));\r\n\r\n        $('#form1').submit();\r\n\r\n    });\r\n\r\n    //テストをクリック\r\n    $('.q_q').on('click',function(){\r\n        var temp_q_q = $('#q_q').text();\r\n\r\n        var q_q = $(this).val();\r\n\r\n        //解答を取得する\r\n        var a_list;\r\n        for( var i = 0 ; i < a_dict['list'].length ; i++ ){\r\n            if( a_dict['list'][i]['q_q'] == q_q ){\r\n                a_list = a_dict['list'][i]['list'];\r\n            }\r\n        }\r\n\r\n        $(\"#res\").children().remove();\r\n        $(\"#res\").append( $('<p>').attr('id','q_q').text(q_q));\r\n        for( var i = 0 ; i < dict['list'].length ; i++ ){\r\n            var item = dict['list'][i];\r\n            if( item['q_q'] == q_q ){\r\n                pdf = item['pdf'];\r\n\r\n                page = 1;\r\n                $(\"#iframe\").attr('src','/static/jg/pdf/question_pm/' + pdf + '#zoom=100&page=1');\r\n                //$('#iframe')[0].contentDocument.location.reload(true)\r\n                //$(\"#pdf\").attr('data','/static/jg/pdf/question_pm/' + pdf + '#page=1');\r\n                //console.log( $('#iframe').attr('src') );\r\n\r\n                $old_question = item['list'][0]['q_question'];\r\n\r\n                for( var j = 0 ; j < item['list'].length ; j++ ){\r\n                    var q_question = item['list'][j]['q_question'];\r\n                    var q_symbol = item['list'][j]['q_symbol'];\r\n                    var q_lastanswer = item['list'][j]['q_lastanswer'];\r\n                    $p = $('<p>').attr('id',q_question);\r\n                    $label = $('<label>').text( q_symbol + \":\" ).attr('for',q_question+\"_\"+q_symbol);\r\n                    $select = $('<select>').attr('id',q_question+\"_\"+q_symbol).attr('class','form-control answer').attr('style','width:100px');\r\n\r\n                    for( var k = 0 ; res_list[k] != q_lastanswer ; k++ ){\r\n                        $select.append( $('<option>').val(res_list[k]).text(res_list[k]));\r\n                    }\r\n                    $select.append( $('<option>').val(q_lastanswer).text(q_lastanswer) );\r\n\r\n                    //前の解答を入れる\r\n                    for( var l = 0 ; l < a_list.length ; l++ ){\r\n                        //console.log( a_list[l]['q_question'] + a_list[l]['u_answer'] );\r\n                        if( a_list[l]['q_question'] == q_question && a_list[l]['q_symbol']==q_symbol){\r\n                            $select.val( a_list[l]['u_answer'] );\r\n                        }\r\n                    }\r\n\r\n                    $p.append( $label , $select );\r\n\r\n                    if( i == 0 || $old_question != q_question ){\r\n                        $(\"#res\").append( $('<p>').text(\"設問\"+q_question));\r\n                    }\r\n\r\n                    $(\"#res\").append( $p );\r\n                    $old_question = q_question;\r\n                }\r\n\r\n            }\r\n            //console.log( item['q_q'] );\r\n        }\r\n\r\n        //初回は実行しない\r\n        if( temp_q_q.length >= 1 ){\r\n            var new_a_dict = {}\r\n            new_a_dict['r_id'] = a_dict['r_id'];\r\n            new_a_dict['q_q'] = temp_q_q;\r\n            new_a_dict['list'] = [];\r\n\r\n            //console.log( getJsonStr( a_dict ) );\r\n\r\n            for(var i = 0 ; i < a_dict['list'].length ; i++ ){\r\n                if( a_dict['list'][i]['q_q'] == temp_q_q ){\r\n                    var temp_list = a_dict['list'][i]['list'];\r\n\r\n                    for(var j = 0 ; j < temp_list.length ; j++ ){\r\n                        var temp = {};\r\n                        temp['q_question'] = temp_list[j]['q_question'];\r\n                        temp['q_symbol'] = temp_list[j]['q_symbol'];\r\n                        temp['u_answer'] = temp_list[j]['u_answer'];\r\n\r\n                        console.log( getJsonStr( temp ));\r\n\r\n                        new_a_dict['list'].push( temp );\r\n                    }\r\n                }\r\n            }\r\n\r\n            console.log( getJsonStr( new_a_dict ) );\r\n\r\n            $.ajaxSetup({\r\n                beforeSend : function(xhr,settings){\r\n                    xhr.setRequestHeader( 'X-CSRFToken',getCSRFToken());\r\n                }\r\n            });\r\n            $.ajax({\r\n                type:\"POST\",\r\n                url:\"/jg/ajax_cbtpm_update/\",\r\n                dataType:'json',\r\n                contentType:'charset=utf-8',\r\n                data:getJsonStr( new_a_dict ),\r\n            }).done( (data) => {\r\n\r\n                console.log( getJsonStr( data ) );\r\n\r\n            }).fail((data)=>{\r\n\r\n            }).always((data)=>{\r\n\r\n            });\r\n\r\n        }\r\n    });\r\n\r\n    $('#review').on('click',function(){\r\n        if( page > 1 ){\r\n            page = page - 1;\r\n        }\r\n\r\n        //$(\"#iframe\").attr('src','');\r\n        //$(\"#iframe\").attr('src','');\r\n        $(\"#iframe\").attr('src','/static/jg/pdf/question_pm/' + pdf + '#zoom=100&page=' + page);\r\n        $('#iframe')[0].contentDocument.location.reload(true)\r\n        //$(\"#pdf\").attr('data','');\r\n        //$(\"#pdf\").attr('data','/static/jg/pdf/question_pm/' + pdf + '#page=' + page);\r\n        console.log( '/static/jg/pdf/question_pm/' + pdf + '#page=' + page );\r\n    });\r\n    $('#nextview').on('click',function(){\r\n        page = page + 1;\r\n        //$(\"#iframe\").attr('src','');\r\n        //$(\"#iframe\").attr('src','');\r\n        $(\"#iframe\").attr('src','/static/jg/pdf/question_pm/' + pdf + '#zoom=100&page=' + page);\r\n        $('#iframe')[0].contentDocument.location.reload(true)\r\n        //$(\"#pdf\").attr('data','');\r\n        //$(\"#pdf\").attr('data','/static/jg/pdf/question_pm/' + pdf + '#page=' + page);\r\n        console.log( '/static/jg/pdf/question_pm/' + pdf + '#page=' + page );\r\n    });\r\n\r\n});\r\n</script>\r\n</head>\r\n<body>\r\n{% csrf_token %}\r\n<div class=\"container-fluid\">\r\n    <div class=\"row\" style=\"margin-top:20px;margin-left:20px\">\r\n        <div class=\"col-md-12\">\r\n            <p>試験区分:<strong id=\"q_test\">{{ dict.q_test }}</strong>\r\n                年度期:<strong id=\"q_period\">{{ dict.q_period }}</strong>\r\n                受験ID:<strong id=\"{{ r_id }}\">{{ r_id }}</strong>\r\n\r\n                <span><input type=\"button\" value=\"戻る\" id=\"review\"></span>\r\n                <span><input type=\"button\" value=\"次へ\" id=\"nextview\"></span>\r\n\r\n                <spam><input type=\"button\" value=\"終了\" id=\"endbtn\"></spam></p>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"row\" style=\"margin-top:5px;margin-left:5px\">\r\n        <div class=\"col_md-1\">\r\n            {% for q in dict.list %}<p><input type=\"button\" value=\"{{ q.q_num }}\" class=\"q_q\" class=\"btn\"></p>{% endfor %}\r\n        </div>\r\n        <div class=\"col-md-8\">\r\n\r\n            <iframe src=\"\" width=\"100%\" height=\"800px\" id=\"iframe\">\r\n                <p><b>表示されない時の表示</b>: <a href=\"pdf.pdf\">PDF をダウンロード</a>.</p>\r\n            </iframe>\r\n\r\n            <!--\r\n            <object type=\"application/pdf\" data=\"\" width=\"100%\" height=\"800px\" id=\"pdf\"></object>\r\n            -->\r\n        </div>\r\n\r\n        <div class=\"col-md-3\" id=\"res\">\r\n\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<form id=\"form1\" action=\"{% url 'jg:cbtpmresult' %}\" method=\"post\">\r\n    {% csrf_token %}\r\n    <input type=\"hidden\" name=\"a_dict\" id=\"a_dict\" value=\"\">\r\n</form>\r\n<!--\r\n<script type=\"text/javascript\" src=\"{% static 'jg/js/cbtpm.js' %}\" charset=\"utf-8\"></script>\r\n-->\r\n\r\n</body>\r\n</html>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- jg/templates/jg/cbtpm.html	(revision 8a3de42db64595b1afa64e882e1b64967b8d07f3)
+++ jg/templates/jg/cbtpm.html	(date 1606206737678)
@@ -11,6 +11,12 @@
 
 <script>
 $(function($){
+
+    history.pushState(null, null, location.href);
+    $(window).on('popstate', function(){
+        history.go(1);
+    });
+
     $(window).on('beforeunload',function(e){
         //e.preventDefault();
         //e.returnValue = '';
@@ -232,20 +238,20 @@
 <body>
 {% csrf_token %}
 <div class="container-fluid">
-    <div class="row" style="margin-top:20px;margin-left:20px">
+    <div class="row" style="margin-top:0px;margin-left:80px;position:fixed;padding:5px;z-index:5;background-color:white;">
         <div class="col-md-12">
             <p>試験区分:<strong id="q_test">{{ dict.q_test }}</strong>
                 年度期:<strong id="q_period">{{ dict.q_period }}</strong>
                 受験ID:<strong id="{{ r_id }}">{{ r_id }}</strong>
 
-                <span><input type="button" value="戻る" id="review"></span>
-                <span><input type="button" value="次へ" id="nextview"></span>
+                <span><input type="button" value="戻る" id="review" style="margin-left:10px;"></span>
+                <span><input type="button" value="次へ" id="nextview" style="margin-left:10px"></span>
 
-                <spam><input type="button" value="終了" id="endbtn"></spam></p>
+                <spam><input type="button" value="終了" id="endbtn" style="margin-left:10px;"></spam></p>
         </div>
     </div>
 
-    <div class="row" style="margin-top:5px;margin-left:5px">
+    <div class="row" style="margin-top:0px;margin-left:5px;position:absolute;top:60px;width:80%;z-index:4;">
         <div class="col_md-1">
             {% for q in dict.list %}<p><input type="button" value="{{ q.q_num }}" class="q_q" class="btn"></p>{% endfor %}
         </div>
Index: jg/templates/jg/cbtpmresultshow.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{% extends 'jgbase.html' %}\r\n\r\n{% block title %}CBT_PM_result{% endblock %}\r\n{% block css %}\r\n{% endblock %}\r\n{% load static %}\r\n{% block main %}\r\n\r\n<div class=\"row\" style=\"margin-top:20px\">\r\n<div class=\"col-md-6\">\r\n        <p>試験ID:{{ a_dict.r_id }} 試験名:{{ a_dict.q_test }} 年度期:{{ a_dict.q_period }} 得点:{{ a_dict.g_total }}</p>\r\n        <p>※は順不同</p>\r\n        <table class=\"table table-condensed\">\r\n            {% for l in a_dict.list %}\r\n            <tr style=\"background-color:yellow\">\r\n                <td colspan=\"7\">\r\n                    問{{ l.q_q }} 正解数:{{ l.total }} 問題数:{{ l.count }} 得点:{{ l.score }}\r\n                    <a href=\"{% static 'jg/pdf/question_pm/' %}{{ l.pdf }}\" target=\"_blank\">問題</a>\r\n                    <a href=\"{% static 'jg/pdf/question_pm/' %}{{ l.ans_pdf }}\" target=\"_blank\">解説</a>\r\n                </td>\r\n            {% for l2 in l.list %}\r\n            {% if l2.correct == 1 %}\r\n            <tr style=\"background-color:#ffcccc\">\r\n            {% else %}\r\n            <tr style=\"background-color:#ccccff\">\r\n            {% endif %}\r\n            <td>設問{{ l2.q_question }}</td>\r\n            <td>{{ l2.q_symbol }}</td>\r\n            <td>あなたの答え:{{ l2.u_answer }}</td>\r\n            <td>正解:{{ l2.q_answer }}</td>\r\n\r\n            {% if l2.correct == 1 %}\r\n            <td>正</td>\r\n            {% else %}\r\n            <td>不</td>\r\n            {% endif %}\r\n            <td>配点:{{ l2.q_allocation }}</td>\r\n            {% if l2.q_remarks == '1' %}\r\n            <td>※</td>\r\n            {% else %}\r\n            <td></td>\r\n            {% endif %}\r\n            </tr>\r\n            {% endfor %}\r\n            </tr>\r\n            {% endfor %}\r\n        </table>\r\n</div>\r\n{% csrf_token %}\r\n{% endblock %}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- jg/templates/jg/cbtpmresultshow.html	(revision 8a3de42db64595b1afa64e882e1b64967b8d07f3)
+++ jg/templates/jg/cbtpmresultshow.html	(date 1606701628384)
@@ -8,7 +8,7 @@
 
 <div class="row" style="margin-top:20px">
 <div class="col-md-6">
-        <p>試験ID:{{ a_dict.r_id }} 試験名:{{ a_dict.q_test }} 年度期:{{ a_dict.q_period }} 得点:{{ a_dict.g_total }}</p>
+    <p>試験ID:<strong id="r_id">{{ a_dict.r_id }}</strong> 試験名:{{ a_dict.q_test }} 年度期:{{ a_dict.q_period }} 得点:{{ a_dict.g_total }} <a href="{% url 'jg:cbtpmmain' %}"><input type="button" value="戻る" style="margin-left:10px"></a><input type="button" value="削除" style="margin-left:10px" id=""btn_delete></p>
         <p>※は順不同</p>
         <table class="table table-condensed">
             {% for l in a_dict.list %}
@@ -45,6 +45,7 @@
             </tr>
             {% endfor %}
         </table>
+</div>
 </div>
 {% csrf_token %}
 {% endblock %}
Index: exam/templates/exam/index.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{% extends 'base.html' %}\r\n\r\n{% block title %}ログイン{% endblock %}\r\n\r\n{% block nav %}{% endblock %}\r\n{% block main %}\r\n<div class=\"row\">\r\n    <div class=\"col-md-4\">\r\n<p>{{ message }}</p>\r\n<form action=\"{% url 'exam:mainpage' %}\" method=\"POST\">\r\n    {% csrf_token %}\r\n    <div class=\"form-group\">\r\n        <label for=\"u_id\">UserId or Email address</label>\r\n        <input type=\"text\" class=\"form-control\" id=\"u_id\" placeholder=\"e-mailまたはユーザIDを入力してください。\" name=\"u_id\">\r\n        <label for=\"u_pass\">Password</label>\r\n        <input type=\"password\" class=\"form-control\" id=\"u_pass\" placeholder=\"Password\" name=\"u_pass\">\r\n    </div>\r\n    <button type=\"submit\" class=\"btn btn-primary\">Submit</button>\r\n</form>\r\n\r\n<p>新規ユーザ登録は<a href=\"{% url 'exam:newuser' %}\">ここ</a>から</p>\r\n\r\n<p>ユーザIDやパスワードを忘れた方は<a href=\"{% url 'exam:inquiry' %}\">ここ</a>から</p>\r\n</div>\r\n</div>\r\n{% endblock %}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- exam/templates/exam/index.html	(revision 8a3de42db64595b1afa64e882e1b64967b8d07f3)
+++ exam/templates/exam/index.html	(date 1606450719066)
@@ -10,8 +10,8 @@
 <form action="{% url 'exam:mainpage' %}" method="POST">
     {% csrf_token %}
     <div class="form-group">
-        <label for="u_id">UserId or Email address</label>
-        <input type="text" class="form-control" id="u_id" placeholder="e-mailまたはユーザIDを入力してください。" name="u_id">
+        <label for="u_id">UserId</label>
+        <input type="text" class="form-control" id="u_id" placeholder="ユーザIDを入力してください。" name="u_id">
         <label for="u_pass">Password</label>
         <input type="password" class="form-control" id="u_pass" placeholder="Password" name="u_pass">
     </div>
